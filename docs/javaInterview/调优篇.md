> 四、**调优篇**
- [jvm调优](#jvm调优)
    - [堆分为新生代和老年代](#堆分为新生代和老年代)
    - [什么时候对象可以进行垃圾收集?？](#什么时候对象可以进行垃圾收集)
    - [垃圾收集算法?](#垃圾收集算法)
    - [对象的引用类型](#对象的引用类型)
    - [jvm的调优机制:](#jvm的调优机制)
    - [通过监控发现，cpu和内存使用率居高不下,重点)](#通过监控发现cpu和内存使用率居高不下重点)
    - [jdk1.8之后的新特性?](#jdk18之后的新特性)
    - [通过Linux 相关命令去查看该jvm的内存使用情况、线程情况](#通过linux-相关命令去查看该jvm的内存使用情况线程情况)
- [数据库调优（重点）](#数据库调优重点)
    - [数据库结构优化](#数据库结构优化)
    - [SQL优化](#sql优化)
    - [使用cache层](#使用cache层)
- [tomcat调优](#tomcat调优)
    - [tomcat的工作原理](#tomcat的工作原理)
    - [tomcat调优](#tomcat调优-1)
_____
### jvm调优
#### 堆分为新生代和老年代
     新生代主要存放的是新创建的对象,新生代主要是采用复制算法进行
	 minorGC，老年代存放的是在新生代阶段被多次gc回收还没有回收掉的对象,
	 老年代也会进行垃圾回收gc(majorGC)，采用的是标记-整理算法,老年代进行GC的时候
	 会造成一个应用程序线程中断的效果，会影响到应用程序的性能.
	 jvm提供了很多种垃圾回收策略,垃圾回收器 CMS、G1(采用多线程进行GC)

#### 什么时候对象可以进行垃圾收集?？
	     1:引入计数法 (解决不了循环引用的问题)（早期虚拟机）原理是此对象有一个引用，即增加一个计数，删除一个引用则减少一个计数。垃圾回收时，只用收集计数为0的对象。此算法最致命的是无法处理循环引用的问题
	     2:可达性分析法  引用链，当一个对象到GC Roots没有任何引用链（即GC Roots到对象不可达）时，
	       则证明此对象是不可用的(现代虚拟机使用的)
#### 垃圾收集算法?
	     1:复制算法
	     2:标记清除算法
	     3:标记整理算法
	     4:分代管理算法(新生代使用复制算法，年老代使用标记整理算法)
#### 对象的引用类型
	      1：强引用（Object obj=new Object()）
	      2：弱引用
	      3：软引用
	      4: 虚引用
#### jvm的调优机制:
             通常我们在项目当中，需要对jvm进行调优，以防止内存溢出的现象。减少GC的频率和Full GC的次数
             主要通过调整jvm的启动参数,包括最小堆内存xms、最大堆内存xmx 栈内存xss,
	     永久代permSize。由于jdk1.8永久代被弃用了，使用操作系统本地内存，
	     所以不需要调节永久代大小了.
	     还包括使用并行的垃圾收集器，比如商用的cms、G1垃圾收集器
	     通常情况下，我们将最小堆内存和最大堆内存设置的一样，防止内存回落
	     造成GC。在生产环境，我们通过使用Jconsole JvisualVm 对jvm可以进行监控

#### 通过监控发现，cpu和内存使用率居高不下,重点)
	 1.可以通过linux top命令 查看机器的cpu和内存使用情况然后通过jstack获取java进程的线程使用情况,然后查看日志，排查问题
	 2.使用jvm监控工具 Jconsole JvisualVM 远程连接到服务器，分析线程和堆栈内存，排查问题，最有可能的问题是:代码死循环，线程死锁、jvm内存溢出等
#### jdk1.8之后的新特性?
	     1：支持函数式编程 Lambda 表达式
         2：方法引用
	     3：集合的stream处理
	     jdk的内存结构发生重大变化：
	     永久代弃用，class信息使用本地内存存储
	     常量池移动到堆当中
	     堆内存、栈内存、永久代内存、方法区内存 
	     垃圾收集器选择 ： CMS G1  串行、并行
	     tomcat的bin目录下面的 catalina.bat  catalina.sh eclipse installerJres  
	 jvm的内存线程线程监控
	    jconson
	    jvisualVm
#### 通过Linux 相关命令去查看该jvm的内存使用情况、线程情况
### 数据库调优（重点）
#### 数据库结构优化
        设计数据库的时候,要预估单表的峰值,因为以Mysql为例,当单表的
	    数据超过千万条,查询速度就特别缓慢了,这里就需要对数据库进行
	    分库分表（数据分片）,为了提高查询和写入性能,mysql可以采取主从结构
	    主数据库采用innodb引擎,从数据库采用myIsam引擎,主从之间通过
	    同步binlog日志实现数据一致
#### SQL优化
       本质是通过创建索引,使用explain关键字,查询索引命中情况,对sql进行调优
#### 使用cache层
       预先对经常常用的数据库数据进行缓存,以减少数据库的压力，提高数据库性能
### tomcat调优
#### tomcat的工作原理
   tomcat的核心组件包括server(服务器) service(服务) conector（连接器） 
   Executor(执行器) engine(servlet引擎).
   server当中有一个catalina服务,调用conector组件接收用户的连接,conector底层
   是通过socketServer监听8080端口号接收客户端的tcp连接的,接收到连接之后,
   会调用 Executor(执行器)创建或捞取线程执行业务逻辑处理,最后再调用servlet
   引擎完成请求以及响应
#### tomcat调优
    1.tomcat默认的线程创建方式,是一次请求,创建一个新的线程来处理
     优化方案,可以配置线程池来创建和管理线程,可以设置线程数量
       <Executor name="tomcatThreadPool" namePrefix="catalina-exec-"
        maxThreads="150" minSpareThreads="4"/>
    2.tomcat默认的连接处理方式是BIO,阻塞的IO,容易造成客户端堵塞
     优化方案：使用http11Nio协议来进行连接的处理Tomcat7以下版本默认情况下是以BIO模式运行的.
     <Connector executor="tomcatThreadPool" 
               port="8088" protocol="org.apache.coyote.http11.Http11NioProtocol"
               connectionTimeout="20000"
			   maxConnections="10000"
               redirectPort="8443" />
    3:因为tomcat是基于jvm的,所以应该对jvm的启动参数进行调优(堆栈内存、垃圾收集器)
